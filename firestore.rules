rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isAuth() { return request.auth != null; }
    function getRole() { return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role; }
    function isAdmin() { return isAuth() && getRole() == 'admin'; }
    function isAdminOrManager() { return isAuth() && (getRole() == 'admin' || getRole() == 'manager'); }
    match /users/{uid} { allow read: if isAuth(); allow write: if isAdmin(); }
    match /leads/{id} { allow read, create, update: if isAuth(); allow delete: if isAdmin(); }
    match /customers/{id} { allow read, create: if isAuth(); allow update: if isAdminOrManager(); allow delete: if isAdmin(); }
    match /installations/{id} { allow read: if isAuth(); allow create, update: if isAdminOrManager(); allow delete: if isAdmin(); }
    match /team/{id} { allow read: if isAuth(); allow create, update: if isAdminOrManager(); allow delete: if isAdmin(); }
    match /materials/{id} { allow read: if isAuth(); allow create, update: if isAdminOrManager(); allow delete: if isAdmin(); }
    match /ongoingWork/{id} { allow read, create, update: if isAuth(); allow delete: if isAdmin(); }
    match /income/{id} { allow read, create: if isAdminOrManager(); allow update, delete: if isAdmin(); }
    match /expenses/{id} { allow read, create: if isAdminOrManager(); allow update, delete: if isAdmin(); }
    match /reminders/{id} { allow read, create, update: if isAuth(); allow delete: if isAdmin(); }
    match /gallery/{id} { allow read: if isAuth(); allow create, update, delete: if isAdminOrManager(); }
    match /company/{id} { allow read: if isAuth(); allow write: if isAdmin(); }
  }
}
